import os
from PIL import Image

base_path = '/var/mnt/vms/cryptwalk_project/assets/ForestRanger/Forest_Ranger_1/PNG/PNG Sequences/'  # Fixed underscore

# List available folders
print("Available folders in PNG Sequences:", [d for d in os.listdir(base_path) if os.path.isdir(os.path.join(base_path, d))])

# All available folders (optional 'prefix' if file names differ)
animations = {
    'Dying': {},
    'Falling Down': {},
    'Hurt': {},
    'Idle': {},
    'Idle Blinking': {},
    'Jump Loop': {},
    'Jump Start': {},
    'Kicking': {},
    'Run Shooting': {},
    'Run Throwing': {},
    'Running': {},
    'Shooting': {},
    'Shooting in The Air': {},
    'Sliding': {},
    'Throwing': {},
    'Throwing in The Air': {},
    'Walking': {},
}

for anim, info in animations.items():
    anim_path = os.path.join(base_path, anim)
    if not os.path.exists(anim_path):
        print(f"Missing folder: {anim_path}")
        continue
    
    prefix = info.get('prefix', anim.replace(' ', '_'))
    
    # Get sorted frame files (exclude any existing combined PNG)
    frame_files = sorted([f for f in os.listdir(anim_path) if f.endswith('.png') and f.startswith('0_Forest_Ranger_') and f != f'{prefix}.png'])
    if not frame_files:
        print(f"No frames found in: {anim_path}")
        continue
    
    # Check if combined already exists
    output_file = os.path.join(anim_path, f'{prefix}.png')
    if os.path.exists(output_file):
        print(f"Already combined: {output_file}")
        continue
    
    # Auto-detect dimensions from first frame
    first_frame_path = os.path.join(anim_path, frame_files[0])
    with Image.open(first_frame_path) as first_frame:
        frame_width, frame_height = first_frame.size
    
    # Create new blank sheet
    sheet_width = frame_width * len(frame_files)
    sheet = Image.new('RGBA', (sheet_width, frame_height))
    
    for i, frame_file in enumerate(frame_files):
        frame_path = os.path.join(anim_path, frame_file)
        with Image.open(frame_path) as frame:
            sheet.paste(frame, (i * frame_width, 0))
    
    sheet.save(output_file)
    print(f"Combined {anim} into {output_file}")

print("Combining complete!")